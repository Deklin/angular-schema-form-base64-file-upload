angular.module("templates",[]).run(["$templateCache",function(e){e.put("src/templates/angular-schema-form-base64-file-upload.html",'<div class="angular-schema-form--base64-file" ng-class="{\'has-error\': form.disableErrorState !== true && hasError(), \'has-success\': form.disableSuccessState !== true && hasSuccess(), \'has-feedback\': form.feedback !== false}"><label class="control-label" ng-hide="form.notitle">{{form.title}}</label><div base64-file-upload="form" sf-field-model="" schema-validate="form" class="base64-file--drop-area" ng-class="{\'file-hovering\': dropAreaHover, \'has-file\': hasFile}"><input type="file" class="base64-file--input" style="visibility:hidden; position:absolute; top:0; left:0;" ng-disabled="hasFile"><div class="base64-file--file-preview" ng-show="hasFile"><div><img ng-show="isImage(file)" ng-src="{{file.src}}"></div><div class="base64-file--file"><div class="base64-file--file-name">{{file.name}}</div><div class="base64-file--file-size">{{file.humanSize}}</div><div class="base64-file--file-remove" ng-click="removeFile($event)">&#10005</div></div></div><button type="button" ng-hide="hasFile"><div class="base64-file--drop-area-description">{{form.placeholder || dropText}}</div></button></div><span class="help-block" sf-message="form.description"></span></div>')}]),angular.module("angularSchemaFormBase64FileUpload",["schemaForm","templates"]).provider("base64FileUploadConfig",function(){this.setDropText=function(e){this.dropText=e},this.$get=function(){return this}}).config(["schemaFormProvider","schemaFormDecoratorsProvider","sfBuilderProvider","sfPathProvider",function(e,i,a,t){var r=function(i,a,r){if("string"===a.type&&"base64"===a.format){var s=e.stdFormObj(i,a,r);return s.key=r.path,s.type="base64file",r.lookup[t.stringify(r.path)]=s,s}};e.defaults.string.unshift(r),i.defineAddOn("bootstrapDecorator","base64file","src/templates/angular-schema-form-base64-file-upload.html",a.stdBuilders)}]),angular.module("angularSchemaFormBase64FileUpload").directive("base64FileUpload",["base64FileUploadConfig","$timeout",function(e,i){var a=["3ds","bmp","btif","cgm","cmx","djv","djvu","dmg","dwg","dxf","fbs","fh","fh4","fh5","fh7","fhc","fpx","fst","g3","gif","ico","ief","iso","jng","jpe","jpeg","jpg","ktx","mdi","mmr","npx","odi","oti","pbm","pct","pcx","pgm","pic","png","pnm","ppm","psd","ras","rgb","rlc","sgi","sid","svg","svgz","t3","tga","tif","tiff","uvg","uvi","uvvg","uvvi","wbmp","wdp","webp","xbm","xif","xpm","xwd"];return{restrict:"A",require:"ngModel",scope:!0,link:function(t,r,s,n){t.ngModel=n;var o=function(e){var i=new String(e).substring(e.lastIndexOf("/")+1);return console.log(i),i.lastIndexOf(".")!=-1&&(i=i.substring(0,i.lastIndexOf("."))),i};t.file=void 0,n.$render=function(){var e=n.$viewValue||"";e&&(e.indexOf(/^(http\:\/\/|https\:\/\/|\/)/gim)<0&&(e="/"+e),t.file={ext:e.split(".").slice(-1)[0],name:o(e),src:e},t.hasFile=!0)},t.dropAreaHover=!1,t.fileError=!1,t.dropText=e.dropText||"Click here or drop files to upload";var l=function(e){var i=!0,a=t.$eval(s.base64FileUpload).schema;return e.size>parseInt(a.maxSize,10)?(i=!1,n.$setValidity("base64FileUploadSize",!1)):n.$setValidity("base64FileUploadSize",!0),t.$apply(),i},d=function(e){if(e&&l(e)){t.file=e,t.file.ext=e.name.split(".").slice(-1)[0],t.file.src=URL.createObjectURL(e),t.hasFile=!0;var a=e.size/1024,r="kB";a>1024&&(a/=1024,r="MB"),t.file.humanSize=a.toFixed(1)+" "+r;var o=t.$eval(s.base64FileUpload).schema.uploadOptions||{};if(o.endpoint){var d=new FormData;d.append("file",e,e.name);for(var f in o)"endpoint"!=f&&d.append(f,o[f]);var p=new XMLHttpRequest;p.open("POST",o.endpoint,!0),p.onload=function(){if(200!==p.status)throw new Error(p.status+": "+p.statusText);var e=JSON.parse(p.responseText);e.file&&n.$setViewValue(e.file)},p.send(d)}else{var c=new FileReader;c.onloadstart=function(e){i(function(){t.loadingFile=!0},0)},c.onload=function(a){i(function(){t.loadingFile=!1},0);var r="file:"+e.name+";";n.$setViewValue(r+a.target.result)},c.readAsDataURL(e)}t.$apply()}};t.isImage=function(e){return!!e&&a.indexOf(e.ext.toLowerCase())>-1},t.removeFile=function(e){e.preventDefault(),e.stopPropagation(),t.file=void 0,t.hasFile=!1,n.$setViewValue(void 0)},r.find("input").bind("change",function(e){d(e.target.files[0])});var f=r[0],p=r.find(".base64-file--input")[0],c=function(e){e.stopPropagation(),p.click()},u=function(e){e.preventDefault(),e.stopPropagation(),i(function(){t.dropAreaHover=!0},0)},v=function(e){e.preventDefault(),e.stopPropagation(),i(function(){t.dropAreaHover=!1},0)},m=function(e){v(e),d(e.dataTransfer.files[0])};f.addEventListener("click",c,!1),f.addEventListener("touchstart",c,!1),f.addEventListener("dragenter",u,!1),f.addEventListener("dragleave",v,!1),f.addEventListener("dragover",u,!1),f.addEventListener("drop",m,!1),t.$on("$destroy",function(){f.removeEventListener("click",c,!1),f.removeEventListener("touchstart",c,!1),f.removeEventListener("dragenter",u,!1),f.removeEventListener("dragleave",v,!1),f.removeEventListener("dragover",u,!1),f.removeEventListener("drop",m,!1)})}}}]);